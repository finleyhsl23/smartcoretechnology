<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SmartCore Technology</title>

  <!-- FAVICON / TAB ICON -->
  <link rel="icon" type="image/png" href="SmartCore Official Logos/SC Icon - Black Background.png">

  <!-- Tailwind (CDN for build phase) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Supabase JS v2 (kept for employee login/sign-in) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --bg0:#020617;
      --bg1:#06153a;
      --panelA: rgba(8, 12, 28, .62);
      --panelB: rgba(8, 12, 28, .45);
      --stroke: rgba(255,255,255,.12);
      --stroke2: rgba(255,255,255,.08);
      --text: #eaf0ff;
      --muted: rgba(234,240,255,.74);
      --muted2: rgba(234,240,255,.58);
      --accent: rgba(120,170,255,.95);
      --accentSoft: rgba(120,170,255,.18);
      --shadow: 0 26px 80px rgba(0,0,0,.55);
      --shadow2: 0 18px 55px rgba(0,0,0,.45);
      --r1: 22px;
      --r2: 16px;
      --blur: 16px;
    }
    html,body{height:100%}
    body{
      margin:0;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: var(--text);
      background:
        radial-gradient(1100px 800px at 50% 10%, rgba(70,120,255,.20), transparent 60%),
        radial-gradient(1200px 900px at 50% 60%, rgba(35,80,220,.14), transparent 62%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    .glass{
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border:1px solid var(--stroke);
      backdrop-filter: blur(var(--blur));
      -webkit-backdrop-filter: blur(var(--blur));
      border-radius: var(--r1);
      box-shadow: var(--shadow);
    }
    .glass2{
      background: rgba(255,255,255,.045);
      border:1px solid var(--stroke2);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      border-radius: var(--r2);
      box-shadow: var(--shadow2);
    }

    .fadeUp{
      opacity:0;
      transform: translateY(10px);
      transition: opacity .45s ease, transform .45s ease;
    }
    .fadeUp.in{ opacity:1; transform: translateY(0); }

    .navHide{ transform: translateY(-120%); transition: transform .28s ease; }
    .navShow{ transform: translateY(0); transition: transform .28s ease; }

    .hero{
      min-height: 100vh;
      position: relative;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 120px 16px 80px;
      overflow:hidden;
    }

    .iconField{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:0;
    }
    .bubble{
      position:absolute;
      width:110px;
      height:110px;
      border-radius:999px;
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
      opacity:.35;
      transform: translate3d(var(--tx,0px), var(--ty,0px), 0);
      transition: transform .12s ease;
    }
    .bubble svg{ width:44px; height:44px; opacity:.9; }

    .modalBackdrop{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.62);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:50;
      padding: 18px;
    }
    .modalBackdrop.show{display:flex;}
    .modal{
      max-width: 980px;
      width: 100%;
      max-height: 86vh;
      overflow: auto;
      border-radius: 20px;
    }
    .noScroll{ overflow:hidden; }

    .inp{
      width:100%;
      border-radius: 14px;
      border:1px solid var(--stroke2);
      background: rgba(255,255,255,.05);
      padding: 12px 12px;
      outline:none;
      color: var(--text);
    }
    .inp::placeholder{ color: rgba(234,240,255,.45); }
    .inp:focus{
      border-color: rgba(120,170,255,.35);
      box-shadow: 0 0 0 3px rgba(120,170,255,.10);
    }

    .eyeBtn{
      border:1px solid var(--stroke2);
      background: rgba(255,255,255,.04);
      border-radius: 12px;
      padding: 10px 12px;
      transition: transform .12s ease, background .12s ease;
    }
    .eyeBtn:hover{
      background: rgba(255,255,255,.07);
      transform: scale(0.98);
    }

    .selected{
      outline: 2px solid rgba(120,170,255,.30);
      background: rgba(120,170,255,.10) !important;
    }
    .tickDot{
      width:10px; height:10px; border-radius:999px;
      background: rgba(255,255,255,.22);
    }
    .selected .tickDot{
      background: rgba(120,170,255,.95);
      box-shadow: 0 0 0 4px rgba(120,170,255,.14);
    }

    /* Make the Custom Module stand out */
    .customCard{
      border:1px solid rgba(120,170,255,.22) !important;
      background: linear-gradient(180deg, rgba(120,170,255,.13), rgba(255,255,255,.04)) !important;
      position: relative;
      overflow:hidden;
    }
    .customBadge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid rgba(120,170,255,.35);
      background: rgba(120,170,255,.14);
      font-size: 12px;
      opacity:.95;
      width: fit-content;
    }

    html{ scroll-behavior:smooth; }
  </style>

  <script>
    window.__SUPABASE_URL  = window.__SUPABASE_URL  || "https://jmgbbybpsnazkxinnpxp.supabase.co";
    window.__SUPABASE_ANON = window.__SUPABASE_ANON || "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImptZ2JieWJwc25hemt4aW5ucHhwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwNjYwNzcsImV4cCI6MjA2NzY0MjA3N30.2_PG1fun3Q2qNaLqxA7f7s2_VIn6BmRO2wcl5_mKSeo";
  </script>
</head>

<body>

  <!-- NAV -->
  <header id="nav" class="fixed top-4 left-0 right-0 z-40 navShow">
    <div class="max-w-6xl mx-auto px-4">
      <div class="glass2 flex items-center justify-between px-4 py-3">
        <div class="flex items-center gap-3 min-w-0">
          <div class="w-10 h-10 rounded-2xl overflow-hidden bg-black/30 border border-white/10 flex items-center justify-center shrink-0">
            <img
              src="SmartCore Official Logos/SC Icon - Black Background.png"
              alt="SmartCore"
              class="w-8 h-8 object-contain translate-y-[-1px]"
              onerror="this.style.display='none'"
            />
          </div>
          <div class="min-w-0">
            <div class="font-semibold tracking-tight leading-tight">
              SmartCore <span class="opacity-70">Technology</span>
            </div>
            <div class="text-xs opacity-70 leading-tight">Practical Technology. Built to Last.</div>
          </div>
        </div>

        <div class="flex items-center gap-2">
          <button id="navHome" class="px-3 py-2 rounded-xl border border-white/10 bg-white/5 hover:bg-white/8 text-sm">
            Home
          </button>
          <button id="navEmployee" class="px-3 py-2 rounded-xl border border-white/10 bg-white/5 hover:bg-white/8 text-sm">
            Employee Sign Up
          </button>
          <button id="navLogin" class="px-3 py-2 rounded-xl border border-white/10 bg-white/5 hover:bg-white/8 text-sm">
            Log In
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section id="hero" class="hero">
    <div id="iconField" class="iconField"></div>

    <div class="relative z-10 w-full max-w-6xl mx-auto px-4">
      <div class="max-w-3xl">
        <div class="fadeUp" data-anim>
          <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-white/10 bg-white/5 text-xs opacity-80">
            <span class="w-2.5 h-2.5 rounded-full" style="background: rgba(120,170,255,.85)"></span>
            SmartCore Platform
          </div>
        </div>

        <h1 class="mt-5 font-extrabold tracking-tight leading-[1.02] fadeUp" data-anim style="font-size: clamp(56px, 7vw, 92px);">
          SmartCore <br>
          <span style="opacity:.72">Technology</span>
        </h1>

        <p class="mt-4 text-[15px] sm:text-[17px] leading-relaxed fadeUp" data-anim style="color: var(--muted); max-width: 42rem;">
          Practical, reliable systems for people, safety, and operational clarity.
          Built to scale sensibly, and designed to work quietly in the background.
        </p>

        <div class="mt-7 flex flex-wrap items-center gap-3 fadeUp" data-anim>
          <button id="heroBuild" class="px-4 py-3 rounded-2xl border border-[rgba(120,170,255,.35)] bg-[rgba(120,170,255,.16)] hover:bg-[rgba(120,170,255,.22)] text-sm font-medium">
            Build Your Plan
          </button>
          <button id="heroEmployee" class="px-4 py-3 rounded-2xl border border-white/10 bg-white/5 hover:bg-white/8 text-sm font-medium">
            Sign Up As An Employee
          </button>
          <button id="heroDown" class="px-3 py-3 rounded-2xl border border-white/10 bg-white/5 hover:bg-white/8" aria-label="Scroll down">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M12 5v12" stroke="white" stroke-opacity=".9" stroke-width="2" stroke-linecap="round"/>
              <path d="M7 14l5 5 5-5" stroke="white" stroke-opacity=".9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>

        <div class="mt-8 fadeUp" data-anim>
          <div class="text-xs opacity-60">
            Support: <a class="underline hover:opacity-100" href="mailto:support@smartcoretechnology.co.uk">support@smartcoretechnology.co.uk</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- MAIN -->
  <main id="main" class="relative z-10">

    <!-- BUILD PLAN -->
    <section id="packages" class="max-w-6xl mx-auto px-4 pb-24">
      <div class="pt-10 sm:pt-16">
        <div class="fadeUp" data-anim>
          <h2 class="text-2xl sm:text-3xl font-bold tracking-tight">Build Your Plan</h2>
          <p class="mt-2 text-sm sm:text-[15px]" style="color: var(--muted); max-width: 52rem;">
            Choose a company size, then add only the systems you need. When you press <b>Continue</b>, an email opens with everything pre-filled ‚Äî we‚Äôll take it from there.
          </p>
        </div>

        <!-- Company size cards -->
        <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 fadeUp" data-anim>
          <button class="glass2 p-4 text-left hover:bg-white/6 transition" data-size="s25">
            <div class="flex items-center justify-between">
              <div class="font-semibold">Up to 25 People</div>
              <div class="tickDot"></div>
            </div>
            <div class="mt-1 text-sm opacity-80">¬£39 / month</div>
            <div class="mt-2 text-xs opacity-60">Ideal for small teams and single sites.</div>
          </button>

          <button class="glass2 p-4 text-left hover:bg-white/6 transition" data-size="s100">
            <div class="flex items-center justify-between">
              <div class="font-semibold">26‚Äì100 People</div>
              <div class="tickDot"></div>
            </div>
            <div class="mt-1 text-sm opacity-80">¬£79 / month</div>
            <div class="mt-2 text-xs opacity-60">For growing businesses and multiple teams.</div>
          </button>

          <button class="glass2 p-4 text-left hover:bg-white/6 transition" data-size="s250">
            <div class="flex items-center justify-between">
              <div class="font-semibold">101‚Äì250 People</div>
              <div class="tickDot"></div>
            </div>
            <div class="mt-1 text-sm opacity-80">¬£149 / month</div>
            <div class="mt-2 text-xs opacity-60">For structured ops and larger organisations.</div>
          </button>

          <button class="glass2 p-4 text-left hover:bg-white/6 transition" data-size="s250plus">
            <div class="flex items-center justify-between">
              <div class="font-semibold">250+ People</div>
              <div class="tickDot"></div>
            </div>
            <div class="mt-1 text-sm opacity-80">Contact us</div>
            <div class="mt-2 text-xs opacity-60">We‚Äôll tailor the plan sensibly.</div>
          </button>
        </div>

        <!-- 250+ extra input -->
        <div id="plusBox" class="mt-4 hidden fadeUp" data-anim>
          <div class="glass2 p-4">
            <div class="font-semibold">250+ Company Size</div>
            <p class="mt-1 text-sm opacity-75">Enter an approximate headcount. This will be included in the email.</p>
            <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3">
              <div>
                <label class="text-xs opacity-70">Approx. employee count</label>
                <input id="plusCount" class="inp mt-1" type="number" min="1" placeholder="e.g. 420">
                <div id="plusWarn" class="mt-2 text-xs text-red-300 hidden"></div>
              </div>
              <div>
                <label class="text-xs opacity-70">Additional notes (optional)</label>
                <input id="plusNotes" class="inp mt-1" type="text" placeholder="Anything helpful for us to know">
              </div>
            </div>
          </div>
        </div>

        <!-- Modules (hidden until company size chosen) -->
        <div id="modulesWrap" class="mt-8 hidden">
          <div class="fadeUp" data-anim>
            <h3 class="text-lg font-semibold">System Modules</h3>
            <p class="mt-1 text-sm" style="color: var(--muted);">Select the modules you want to include in your plan.</p>
          </div>
          <div id="modulesGrid" class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3"></div>

          <!-- Custom module details (only shows when selected) -->
          <div id="customBox" class="mt-4 hidden fadeUp" data-anim>
            <div class="glass2 p-4">
              <div class="flex items-center justify-between gap-3 flex-wrap">
                <div>
                  <div class="font-semibold">Custom Module ‚Äî Built personally for your company</div>
                  <div class="text-sm opacity-75 mt-1">Tell us what you want building. This gets inserted into the email.</div>
                </div>
                <div class="customBadge">
                  <span class="w-2.5 h-2.5 rounded-full" style="background: rgba(120,170,255,.85)"></span>
                  Recommended
                </div>
              </div>

              <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
                <div class="sm:col-span-2">
                  <label class="text-xs opacity-70">What is it?</label>
                  <input id="cWhat" class="inp mt-1" placeholder="e.g. A vehicle inspection app with photo evidence and sign-off" />
                </div>
                <div class="sm:col-span-2">
                  <label class="text-xs opacity-70">What‚Äôs it for?</label>
                  <input id="cFor" class="inp mt-1" placeholder="e.g. Standardise checks, reduce rework, create audit trail" />
                </div>
                <div>
                  <label class="text-xs opacity-70">Who uses it?</label>
                  <input id="cWho" class="inp mt-1" placeholder="e.g. Engineers, Supervisors, Admin team" />
                </div>
                <div>
                  <label class="text-xs opacity-70">Where is it used?</label>
                  <input id="cWhere" class="inp mt-1" placeholder="e.g. Mobile on-site + office dashboard" />
                </div>
                <div class="sm:col-span-2">
                  <label class="text-xs opacity-70">Key features (comma separated)</label>
                  <input id="cFeatures" class="inp mt-1" placeholder="e.g. photo upload, signatures, reminders, reporting" />
                </div>
                <div class="sm:col-span-2">
                  <label class="text-xs opacity-70">Integrations / systems it must work with (optional)</label>
                  <input id="cIntegrations" class="inp mt-1" placeholder="e.g. Microsoft 365, SharePoint, Xero, existing database" />
                </div>
                <div>
                  <label class="text-xs opacity-70">Rough timescale (optional)</label>
                  <input id="cTimescale" class="inp mt-1" placeholder="e.g. ASAP / 4‚Äì6 weeks / Q3" />
                </div>
                <div>
                  <label class="text-xs opacity-70">Budget range (optional)</label>
                  <input id="cBudget" class="inp mt-1" placeholder="e.g. ¬£2k‚Äì¬£5k / unsure" />
                </div>
              </div>

              <div id="customWarn" class="mt-3 text-sm text-red-300 hidden"></div>
            </div>
          </div>
        </div>

        <!-- ABOUT -->
        <div class="mt-14 fadeUp" data-anim>
          <div class="glass p-6 sm:p-8">
            <h3 class="text-xl sm:text-2xl font-bold tracking-tight">About SmartCore Technology</h3>

            <p class="mt-4 text-sm sm:text-[15px] leading-relaxed" style="color: var(--muted);">
              SmartCore Technology was built by Finley Hassall, an enthusiastic founder with a long-standing passion for technology and a strong business mindset.
              Interested in IT from the age of six, Finley always knew he wanted to build a career creating systems that solve real-world problems.
            </p>

            <p class="mt-4 text-sm sm:text-[15px] leading-relaxed" style="color: var(--muted);">
              Rather than focusing on trends or hype, SmartCore Technology was created with a clear goal: to build practical, reliable systems that businesses can depend on every day.
            </p>

            <p class="mt-4 text-sm sm:text-[15px] leading-relaxed" style="color: var(--muted);">
              The company was developed with guidance and support from Finley‚Äôs mother, a business owner herself, but every system within SmartCore has been hand-crafted from the ground up by Finley.
              Each feature, workflow, and decision has been designed with real workplaces in mind ‚Äî prioritising clarity, usability, and long-term reliability over unnecessary complexity.
            </p>

            <p class="mt-4 text-sm sm:text-[15px] leading-relaxed" style="color: var(--muted);">
              SmartCore Technology is not about flashy software. It‚Äôs about building tools that work properly, scale sensibly, and quietly do their job in the background.
            </p>
          </div>
        </div>

      </div>
    </section>

    <!-- FOOTER -->
    <footer class="max-w-6xl mx-auto px-4 pb-10">
      <div class="glass2 p-5 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
        <div class="text-sm opacity-80">SmartCore Technology</div>
        <a class="text-sm opacity-80 underline hover:opacity-100" href="mailto:support@smartcoretechnology.co.uk">
          support@smartcoretechnology.co.uk
        </a>
      </div>
    </footer>
  </main>

  <!-- STICKY SUMMARY -->
  <div id="summaryBar" class="fixed bottom-4 left-0 right-0 z-30 hidden">
    <div class="max-w-6xl mx-auto px-4">
      <div class="glass2 p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
        <div class="flex items-center justify-between sm:justify-start gap-6">
          <div>
            <div class="text-xs opacity-70">Monthly estimate</div>
            <div class="text-lg font-semibold" id="totalText">¬£0 / month</div>
          </div>
          <div class="hidden sm:block text-xs opacity-60" id="summaryMini">Select a company size to begin.</div>
        </div>

        <button id="checkoutBtn" class="px-4 py-3 rounded-2xl border border-[rgba(120,170,255,.35)] bg-[rgba(120,170,255,.16)] hover:bg-[rgba(120,170,255,.22)] text-sm font-medium">
          Continue
        </button>
      </div>
    </div>
  </div>

  <!-- MODAL: Module Learn More -->
  <div id="moduleModalBackdrop" class="modalBackdrop">
    <div class="modal glass p-5 sm:p-6">
      <div class="flex items-start justify-between gap-3">
        <div>
          <div id="mmTitle" class="text-xl sm:text-2xl font-bold"></div>
          <div id="mmPrice" class="mt-1 text-sm opacity-80"></div>
        </div>
        <button id="mmClose" class="px-3 py-2 rounded-xl border border-white/10 bg-white/5 hover:bg-white/8 text-sm">Close</button>
      </div>

      <div class="mt-4 grid grid-cols-1 lg:grid-cols-2 gap-4">
        <div class="glass2 p-4">
          <div class="text-sm font-semibold">Preview</div>
          <div class="mt-3 rounded-2xl overflow-hidden border border-white/10 bg-black/30">
            <iframe
              id="mmVideo"
              class="w-full aspect-video"
              src="https://www.youtube.com/embed/S2kymv60ndQ"
              title="Module preview"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen"
              allowfullscreen
            ></iframe>
          </div>
          <div class="mt-2 text-xs opacity-60">Open fullscreen using the video player controls.</div>
        </div>

        <div class="glass2 p-4">
          <div class="text-sm font-semibold">Summary</div>
          <p id="mmSummary" class="mt-2 text-sm leading-relaxed opacity-80"></p>

          <div class="mt-4 text-sm font-semibold">Key features</div>
          <ul id="mmBullets" class="mt-2 space-y-2 text-sm opacity-80"></ul>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL: Employee sign-up (kept, with verification) -->
  <div id="empModalBackdrop" class="modalBackdrop">
    <div class="modal glass p-5 sm:p-6" style="max-width: 760px;">
      <div class="flex items-start justify-between gap-3">
        <div>
          <div class="text-xl sm:text-2xl font-bold">Employee sign-up</div>
          <div class="mt-1 text-sm opacity-75">Enter your company code and your name exactly as your admin added it.</div>
        </div>
        <button id="empClose" class="px-3 py-2 rounded-xl border border-white/10 bg-white/5 hover:bg-white/8 text-sm">Close</button>
      </div>

      <div class="mt-5 grid grid-cols-1 sm:grid-cols-2 gap-3">
        <div class="sm:col-span-2">
          <label class="text-xs opacity-70">Company code</label>
          <input id="empCompanyCode" class="inp mt-1" placeholder="e.g. SMA624564" />
        </div>
        <div class="sm:col-span-2">
          <label class="text-xs opacity-70">Full name</label>
          <input id="empFullName" class="inp mt-1" placeholder="e.g. Finley Hassall" />
        </div>
        <div class="sm:col-span-2">
          <label class="text-xs opacity-70">Email</label>
          <input id="empEmail" class="inp mt-1" type="email" placeholder="you@company.co.uk" />
        </div>
        <div class="sm:col-span-2">
          <label class="text-xs opacity-70">Password</label>
          <div class="mt-1 flex gap-2">
            <input id="empPassword" class="inp" type="password" placeholder="Minimum 8 characters" />
            <button id="empEye" type="button" class="eyeBtn" aria-label="Show/hide password">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                <path d="M2.5 12s3.5-7 9.5-7 9.5 7 9.5 7-3.5 7-9.5 7-9.5-7-9.5-7Z" stroke="white" stroke-opacity=".85" stroke-width="2"/>
                <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" stroke="white" stroke-opacity=".85" stroke-width="2"/>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <div id="empMsg" class="mt-4 text-sm text-red-300 hidden"></div>

      <div class="mt-5 flex items-center justify-between gap-3">
        <button id="empSend" class="px-4 py-3 rounded-2xl border border-[rgba(120,170,255,.35)] bg-[rgba(120,170,255,.16)] hover:bg-[rgba(120,170,255,.22)] text-sm font-medium">
          Send verification code
        </button>
      </div>

      <div id="empVerifyBox" class="mt-5 hidden glass2 p-4">
        <div class="font-semibold">Verify</div>
        <div class="mt-2 text-sm opacity-75">Enter the 6-digit code sent to your email.</div>

        <div class="mt-3">
          <label class="text-xs opacity-70">6-digit code</label>
          <input id="empCode" class="inp mt-1 text-center tracking-[0.4em]" maxlength="6" placeholder="123456" />
        </div>

        <div id="empVerifyMsg" class="mt-3 text-sm text-red-300 hidden"></div>

        <div class="mt-4 flex gap-3">
          <button id="empVerify" class="flex-1 px-4 py-3 rounded-2xl border border-[rgba(120,170,255,.35)] bg-[rgba(120,170,255,.16)] hover:bg-[rgba(120,170,255,.22)] text-sm font-medium">
            Verify & create account
          </button>
          <button id="empResend" class="px-4 py-3 rounded-2xl border border-white/10 bg-white/5 hover:bg-white/8 text-sm font-medium">
            Resend
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL: Employee login (kept minimal) -->
  <div id="loginModalBackdrop" class="modalBackdrop">
    <div class="modal glass p-5 sm:p-6" style="max-width: 680px;">
      <div class="flex items-start justify-between gap-3">
        <div>
          <div class="text-xl sm:text-2xl font-bold">Log in</div>
          <div class="mt-1 text-sm opacity-75">Employee access (if your company is already set up).</div>
        </div>
        <button id="liClose" class="px-3 py-2 rounded-xl border border-white/10 bg-white/5 hover:bg-white/8 text-sm">Close</button>
      </div>

      <div class="mt-5 grid grid-cols-1 gap-3">
        <div>
          <label class="text-xs opacity-70">Email</label>
          <input id="liEmail" class="inp mt-1" type="email" placeholder="you@company.co.uk" />
        </div>
        <div>
          <label class="text-xs opacity-70">Password</label>
          <div class="mt-1 flex gap-2">
            <input id="liPassword" class="inp" type="password" placeholder="Your password" />
            <button id="liEye" type="button" class="eyeBtn" aria-label="Show/hide password">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                <path d="M2.5 12s3.5-7 9.5-7 9.5 7 9.5 7-3.5 7-9.5 7-9.5-7-9.5-7Z" stroke="white" stroke-opacity=".85" stroke-width="2"/>
                <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" stroke="white" stroke-opacity=".85" stroke-width="2"/>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <div id="liMsg" class="mt-4 text-sm text-red-300 hidden"></div>

      <div class="mt-5 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
        <button id="liLogin" class="px-4 py-3 rounded-2xl border border-[rgba(120,170,255,.35)] bg-[rgba(120,170,255,.16)] hover:bg-[rgba(120,170,255,.22)] text-sm font-medium">
          Log In
        </button>
        <button id="liReset" class="underline text-sm opacity-80 hover:opacity-100 text-left">
          Forgot your password?
        </button>
      </div>

      <div class="mt-4 text-xs opacity-60">
        Note: if your company is not yet set up, use <b>Build Your Plan</b> and email us ‚Äî we‚Äôll handle it manually.
      </div>
    </div>
  </div>

  <script>
    /******************************************************************
      UTIL
    ******************************************************************/
    const $ = (id) => document.getElementById(id);

    function show(el){ el.classList.remove("hidden"); }
    function hide(el){ el.classList.add("hidden"); }
    function setText(el, t){ el.textContent = t; }

    function openModal(backdrop){
      backdrop.classList.add("show");
      document.body.classList.add("noScroll");
    }
    function closeModal(backdrop){
      backdrop.classList.remove("show");
      document.body.classList.remove("noScroll");
    }

    function showErr(el, msg){
      el.textContent = msg;
      el.classList.remove("hidden");
      el.classList.remove("text-green-300");
      el.classList.add("text-red-300");
    }
    function showOk(el, msg){
      el.textContent = msg;
      el.classList.remove("hidden");
      el.classList.remove("text-red-300");
      el.classList.add("text-green-300");
    }
    function clearErr(el){
      el.textContent = "";
      el.classList.add("hidden");
      el.classList.remove("text-green-300");
      el.classList.add("text-red-300");
    }

    function money(n){
      const v = Number(n || 0);
      return "¬£" + v.toFixed(0);
    }

    /******************************************************************
      SUPABASE (single init, no redeclare)
    ******************************************************************/
    let sb = window.__SB_CLIENT;
    if (!sb){
      sb = window.supabase.createClient(window.__SUPABASE_URL, window.__SUPABASE_ANON);
      window.__SB_CLIENT = sb;
    }

    /******************************************************************
      DATA
    ******************************************************************/
    const COMPANY_SIZES = [
      { id:"s25", label:"Up to 25 People", price:39 },
      { id:"s100", label:"26‚Äì100 People", price:79 },
      { id:"s250", label:"101‚Äì250 People", price:149 },
      { id:"s250plus", label:"250+ People", price:0 }
    ];

    const MODULES = [
      // PROMOTED custom module
      { id:"custom_module", name:"Custom Module ‚Äî Built Personally For Your Company", price:0, isCustom:true,
        full:`A bespoke system designed around your exact workflow. We‚Äôll scope it properly, keep it practical, and build it to last.`,
        bullets:["Designed around your real process","Simple, usable UX","Audit-ready records","Built to integrate sensibly","Delivered with clear ownership"]
      },

      { id:"presence_fire", name:"Presence & Fire Safety", price:10,
        full:`A real-time presence system that shows exactly who is on site at any moment. Staff and visitors sign in and out digitally, creating a live evacuation list that can be used immediately during fire drills or real emergencies.`,
        bullets:["Live on-site list for staff and visitors","Instant evacuation roll call","Clear, auditable sign-in history","Fast kiosk-friendly workflows","Fire drill & incident support"]
      },
      { id:"policies_handbook", name:"Policies & Staff Handbook", price:7,
        full:`A central location for company policies and staff handbooks, with tracking to show who has read and acknowledged each document.`,
        bullets:["Policy library with versioning","Read & acknowledge tracking","Re-acknowledgement requests","Manager reporting","Audit exports"]
      },
      { id:"holiday_booking", name:"Holiday Booking", price:8,
        full:`A straightforward holiday request and approval system that removes unnecessary back-and-forth.`,
        bullets:["Request ‚Üí approve/decline flow","Team absence calendar","Audit history","Simple by design","No payroll complexity"]
      },
      { id:"accident_injury", name:"Accident & Injury Book", price:3,
        full:`A digital accident and injury reporting system that replaces paper accident books.`,
        bullets:["Quick incident logging","Photos and witness details","Searchable records","Export when required","Better than paper"]
      },
      { id:"training_compliance", name:"Training & Compliance", price:9,
        full:`Tracks training expiry dates, compliance requirements, and scheduled checks across the organisation.`,
        bullets:["Expiry tracking","Automated reminders","Compliance calendar","Manager oversight","Consistent standards"]
      },
      { id:"onboarding_offboarding", name:"Onboarding & Offboarding", price:8,
        full:`Structured checklists for new starters and leavers, helping teams complete tasks consistently.`,
        bullets:["Starter & leaver checklists","Clear ownership","Audit trail","Avoid missed steps","Consistent transitions"]
      },
      { id:"expenses_upload", name:"Expenses Upload", price:6,
        full:`Allows staff to upload receipts digitally with notes and categories.`,
        bullets:["Receipt uploads","Simple categories","Review flow","Exports for accounts","No paper chasing"]
      },
      { id:"wellbeing_check", name:"Wellbeing Check", price:4,
        full:`A lightweight wellbeing check-in with three states: üôÇ Positive (green), üòê Neutral (amber), üôÅ Concerned (red).`,
        bullets:["3-state wellbeing pulse","Trend visibility","Privacy-respecting","Quick to use","Helps surface support needs"]
      }
    ];

    /******************************************************************
      STATE
    ******************************************************************/
    const state = {
      size: null,
      selectedModules: new Set(),
      plusNotes: "",
      pendingEmployee: null // { company_code, full_name, email, password }
    };

    /******************************************************************
      ICONS (desktop only)
    ******************************************************************/
    const iconField = $("iconField");
    const iconSVGs = [
      `<svg viewBox="0 0 24 24" fill="none"><path d="M12 3l8 4v6c0 5-3.5 8.5-8 8.5S4 18 4 13V7l8-4Z" stroke="white" stroke-opacity=".92" stroke-width="2"/></svg>`,
      `<svg viewBox="0 0 24 24" fill="none"><path d="M12 15a3 3 0 100-6 3 3 0 000 6Z" stroke="white" stroke-opacity=".92" stroke-width="2"/><path d="M19.4 15a8 8 0 10-14.8 0" stroke="white" stroke-opacity=".55" stroke-width="2"/></svg>`,
      `<svg viewBox="0 0 24 24" fill="none"><path d="M7 7h10v10H7V7Z" stroke="white" stroke-opacity=".92" stroke-width="2"/><path d="M4 10V4h6" stroke="white" stroke-opacity=".6" stroke-width="2"/><path d="M20 14v6h-6" stroke="white" stroke-opacity=".6" stroke-width="2"/></svg>`,
      `<svg viewBox="0 0 24 24" fill="none"><path d="M8 12h8" stroke="white" stroke-opacity=".92" stroke-width="2" stroke-linecap="round"/><path d="M12 8v8" stroke="white" stroke-opacity=".92" stroke-width="2" stroke-linecap="round"/></svg>`,
      `<svg viewBox="0 0 24 24" fill="none"><path d="M6 19h12M9 19V9l3-4 3 4v10" stroke="white" stroke-opacity=".85" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`
    ];
    const bubbles = [];

    function buildBubbles(){
      iconField.innerHTML = "";
      bubbles.length = 0;
      const isDesktop = window.matchMedia("(pointer:fine)").matches && window.innerWidth >= 900;
      if (!isDesktop) return;

      const positions = [
        {x: 12, y: 18}, {x: 72, y: 16}, {x: 86, y: 48}, {x: 58, y: 62},
        {x: 18, y: 60}, {x: 36, y: 36}, {x: 84, y: 78}, {x: 10, y: 82}
      ];

      positions.forEach((p, i) => {
        const b = document.createElement("div");
        b.className = "bubble";
        b.style.left = p.x + "%";
        b.style.top = p.y + "%";
        b.innerHTML = iconSVGs[i % iconSVGs.length];
        b.style.setProperty("--tx", "0px");
        b.style.setProperty("--ty", "0px");
        iconField.appendChild(b);
        bubbles.push(b);
      });
    }

    function bubbleParallax(e){
      if (!bubbles.length) return;
      const rect = $("hero").getBoundingClientRect();
      const cx = rect.left + rect.width/2;
      const cy = rect.top + rect.height/2;
      const dx = (e.clientX - cx) / rect.width;
      const dy = (e.clientY - cy) / rect.height;

      bubbles.forEach((b, idx) => {
        const strength = 18 + (idx % 3) * 6;
        b.style.setProperty("--tx", (dx * strength * -1).toFixed(1) + "px");
        b.style.setProperty("--ty", (dy * strength * -1).toFixed(1) + "px");
      });
    }

    /******************************************************************
      ANIMATIONS / NAV HIDE
    ******************************************************************/
    function initAnim(){
      const els = document.querySelectorAll("[data-anim]");
      const io = new IntersectionObserver((entries)=>{
        entries.forEach(en=>{
          if(en.isIntersecting) en.target.classList.add("in");
        });
      }, { threshold: 0.12 });
      els.forEach(el=>{
        el.classList.add("fadeUp");
        io.observe(el);
      });
    }

    function initNavHide(){
      const nav = $("nav");
      const hero = $("hero");
      const io = new IntersectionObserver((entries)=>{
        const en = entries[0];
        if(en.isIntersecting){
          nav.classList.remove("navHide");
          nav.classList.add("navShow");
        }else{
          nav.classList.remove("navShow");
          nav.classList.add("navHide");
        }
      }, { threshold: 0.10 });
      io.observe(hero);
    }

    /******************************************************************
      MODULES RENDER
    ******************************************************************/
    function renderModules(){
      const grid = $("modulesGrid");
      grid.innerHTML = "";

      MODULES.forEach(m => {
        const selected = state.selectedModules.has(m.id);

        const card = document.createElement("div");
        card.className = "glass2 p-4 flex flex-col gap-3 hover:bg-white/6 transition cursor-pointer";
        if (selected) card.classList.add("selected");
        if (m.isCustom) card.classList.add("customCard");

        const priceText = (m.isCustom) ? "Price quoted after scoping" : `${money(m.price)} / month`;
        const tag = m.isCustom ? `<div class="customBadge"><span class="w-2.5 h-2.5 rounded-full" style="background: rgba(120,170,255,.85)"></span> Custom build</div>` : "";

        card.innerHTML = `
          <div class="flex items-start justify-between gap-3">
            <div class="min-w-0">
              ${tag}
              <div class="font-semibold leading-tight mt-2">${m.name}</div>
              <div class="text-sm opacity-80 mt-1">${priceText}</div>
              ${m.isCustom ? `<div class="text-xs opacity-70 mt-2">Built personally around your workflow ‚Äî we‚Äôll help scope it properly.</div>` : ``}
            </div>
            <div class="tickDot mt-1"></div>
          </div>

          <div class="flex items-center justify-between gap-3 mt-1">
            <button class="learnMore px-3 py-2 rounded-xl border border-white/10 bg-white/5 hover:bg-white/8 text-sm whitespace-nowrap">
              Learn more
            </button>
            <div class="text-xs opacity-60">${selected ? "Selected" : "Click to select"}</div>
          </div>
        `;

        card.addEventListener("click", (e) => {
          if (e.target && e.target.classList.contains("learnMore")) return;
          toggleModule(m.id);
        });

        card.querySelector(".learnMore").addEventListener("click", (e) => {
          e.preventDefault();
          e.stopPropagation();
          openModuleModal(m.id);
        });

        grid.appendChild(card);
      });

      // show custom details box if selected
      if (state.selectedModules.has("custom_module")) show($("customBox"));
      else hide($("customBox"));

      updateTotal();
    }

    function toggleModule(id){
      if (state.selectedModules.has(id)) state.selectedModules.delete(id);
      else state.selectedModules.add(id);
      renderModules();
    }

    function openModuleModal(id){
      const m = MODULES.find(x=>x.id===id);
      if(!m) return;

      setText($("mmTitle"), m.name);
      setText($("mmPrice"), m.isCustom ? "Price quoted after scoping" : `${money(m.price)} / month`);
      setText($("mmSummary"), m.full);

      const bullets = $("mmBullets");
      bullets.innerHTML = "";
      m.bullets.forEach(b=>{
        const li = document.createElement("li");
        li.className = "flex gap-2";
        li.innerHTML = `<span class="opacity-70">‚Ä¢</span><span>${b}</span>`;
        bullets.appendChild(li);
      });

      $("mmVideo").src = "https://www.youtube.com/embed/S2kymv60ndQ";
      openModal($("moduleModalBackdrop"));
    }

    /******************************************************************
      COMPANY SIZE / TOTAL
    ******************************************************************/
    function setCompanySize(sizeId){
      const size = COMPANY_SIZES.find(s=>s.id===sizeId);
      state.size = size || null;

      document.querySelectorAll("[data-size]").forEach(btn=>{
        btn.classList.remove("selected");
        if(btn.dataset.size === sizeId) btn.classList.add("selected");
      });

      if(state.size){
        show($("modulesWrap"));
        show($("summaryBar"));
        if (state.size.id === "s250plus") show($("plusBox"));
        else {
          hide($("plusBox"));
          $("plusCount").value = "";
          $("plusNotes").value = "";
          hide($("plusWarn"));
          state.plusNotes = "";
        }
      } else {
        hide($("modulesWrap"));
        hide($("summaryBar"));
        hide($("plusBox"));
      }

      renderModules();
      updateTotal();
    }

    function computeTotal(){
      const base = state.size?.price || 0;
      let mods = 0;
      state.selectedModules.forEach(id=>{
        const m = MODULES.find(x=>x.id===id);
        if(!m) return;
        if(m.isCustom) return; // custom quoted separately
        mods += (m.price || 0);
      });
      return base + mods;
    }

    function updateTotal(){
      if(!state.size){
        setText($("totalText"), "¬£0 / month");
        setText($("summaryMini"), "Select a company size to begin.");
        return;
      }
      const total = computeTotal();
      setText($("totalText"), `${money(total)} / month`);
      setText($("summaryMini"), `${state.size.label} + ${state.selectedModules.size} module(s)`);
      $("checkoutBtn").textContent = "Continue";
    }

    /******************************************************************
      BUILD EMAIL (for ALL sizes now)
    ******************************************************************/
    function getCustomDetails(){
      return {
        what: ($("cWhat")?.value || "").trim(),
        for: ($("cFor")?.value || "").trim(),
        who: ($("cWho")?.value || "").trim(),
        where: ($("cWhere")?.value || "").trim(),
        features: ($("cFeatures")?.value || "").trim(),
        integrations: ($("cIntegrations")?.value || "").trim(),
        timescale: ($("cTimescale")?.value || "").trim(),
        budget: ($("cBudget")?.value || "").trim()
      };
    }

    function validateCustomDetails(){
      clearErr($("customWarn"));
      if(!state.selectedModules.has("custom_module")) return true;

      const d = getCustomDetails();
      if(!d.what || !d.for || !d.who){
        showErr($("customWarn"), "Please fill in at least: What is it, What‚Äôs it for, and Who uses it.");
        return false;
      }
      return true;
    }

    function buildPlanEmail(){
      if(!state.size){
        alert("Select a company size first.");
        return null;
      }

      // for 250+ we require a number (as requested earlier), but now it‚Äôs just for the email content
      let approx = null;
      let notes = "";
      if(state.size.id === "s250plus"){
        approx = Number($("plusCount").value || 0);
        notes = ($("plusNotes").value || "").trim();
        if(!approx || approx < 1){
          showErr($("plusWarn"), "Please enter an approximate company size to continue.");
          return null;
        }
        hide($("plusWarn"));
      } else {
        notes = ($("plusNotes").value || "").trim();
      }

      if(!validateCustomDetails()) return null;

      const selected = Array.from(state.selectedModules)
        .map(id => MODULES.find(m=>m.id===id))
        .filter(Boolean);

      // Put custom module last in the email, after the list
      const custom = selected.find(m=>m.id==="custom_module");
      const normal = selected.filter(m=>m.id!=="custom_module");

      const total = computeTotal();
      const subject = `SmartCore Plan Request ‚Äî ${state.size.label}`;

      const lines = [];
      lines.push("Hello SmartCore Technology,");
      lines.push("");
      lines.push("We would like to move forward with SmartCore. Below are the details of what we need:");
      lines.push("");
      lines.push(`Company size: ${state.size.label}${state.size.id==="s250plus" ? ` (approx. ${approx})` : ""}`);
      lines.push(`Monthly estimate (excluding any custom build): ${money(total)} / month`);
      lines.push("");

      lines.push("Requested modules:");
      if(normal.length){
        normal.forEach(m=>{
          lines.push(`- ${m.name}`);
        });
      } else {
        lines.push("- (none selected)");
      }

      if(custom){
        const d = getCustomDetails();
        lines.push("");
        lines.push("Custom Module ‚Äî Built Personally For Your Company:");
        lines.push(`What is it: ${d.what || "‚Äî"}`);
        lines.push(`What‚Äôs it for: ${d.for || "‚Äî"}`);
        lines.push(`Who uses it: ${d.who || "‚Äî"}`);
        lines.push(`Where is it used: ${d.where || "‚Äî"}`);
        lines.push(`Key features: ${d.features || "‚Äî"}`);
        lines.push(`Integrations / must work with: ${d.integrations || "‚Äî"}`);
        lines.push(`Timescale: ${d.timescale || "‚Äî"}`);
        lines.push(`Budget range: ${d.budget || "‚Äî"}`);
      }

      if(state.size.id==="s250plus" && notes){
        lines.push("");
        lines.push("Additional notes:");
        lines.push(notes);
      }

      lines.push("");
      lines.push("Please reply with next steps.");
      lines.push("");
      lines.push("Kind regards,");
      lines.push("(Your name)");

      const body = lines.join("\n");
      return `mailto:support@smartcoretechnology.co.uk?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    }

    /******************************************************************
      API helper (Cloudflare functions)
    ******************************************************************/
    async function apiPost(path, payload){
      const res = await fetch(path, {
        method:"POST",
        headers: { "content-type":"application/json" },
        body: JSON.stringify(payload || {})
      });

      const txt = await res.text();
      let data = null;
      try{ data = JSON.parse(txt); }catch(_){}

      if(!res.ok){
        const msg = (data && (data.error || data.message)) ? (data.error || data.message) : txt;
        throw new Error(msg || ("Request failed: " + res.status));
      }
      return data ?? {};
    }

    /******************************************************************
      EMPLOYEE SIGNUP (kept with verification code)
      Assumes your backend supports:
      - POST /api/send-code   { email, purpose:"employee_signup" }
      - POST /api/verify-code { phase:"finalise", purpose:"employee_signup", ... }
    ******************************************************************/
    async function employeeSendCode(){
      clearErr($("empMsg"));
      clearErr($("empVerifyMsg"));

      const company_code = $("empCompanyCode").value.trim();
      const full_name = $("empFullName").value.trim();
      const email = $("empEmail").value.trim().toLowerCase();
      const password = $("empPassword").value;

      if(!company_code) return showErr($("empMsg"), "Please enter your company code.");
      if(!full_name) return showErr($("empMsg"), "Please enter your full name.");
      if(!email) return showErr($("empMsg"), "Please enter your email.");
      if(!password || password.length < 8) return showErr($("empMsg"), "Password must be at least 8 characters.");

      state.pendingEmployee = { company_code, full_name, email, password };

      $("empSend").disabled = true;
      $("empSend").classList.add("opacity-60");

      try{
        await apiPost("/api/send-code", { email, purpose:"employee_signup" });
        show($("empVerifyBox"));
        $("empCode").value = "";
        showOk($("empMsg"), "Code sent. Please check your inbox.");
      }catch(e){
        showErr($("empMsg"), String(e.message || "Failed to send code."));
      }finally{
        $("empSend").disabled = false;
        $("empSend").classList.remove("opacity-60");
      }
    }

    async function employeeResend(){
      clearErr($("empVerifyMsg"));
      if(!state.pendingEmployee?.email) return showErr($("empVerifyMsg"), "Please fill in your details above first.");
      try{
        await apiPost("/api/send-code", { email: state.pendingEmployee.email, purpose:"employee_signup" });
        showOk($("empVerifyMsg"), "New code sent. Please check your inbox.");
      }catch(e){
        showErr($("empVerifyMsg"), String(e.message || "Failed to resend code."));
      }
    }

    async function employeeVerifyAndCreate(){
      clearErr($("empVerifyMsg"));

      const code = $("empCode").value.trim();
      if(!code || code.length !== 6) return showErr($("empVerifyMsg"), "Please enter the 6-digit code.");

      const p = state.pendingEmployee;
      if(!p?.company_code || !p?.full_name || !p?.email || !p?.password){
        return showErr($("empVerifyMsg"), "Your details weren‚Äôt saved. Please close and start again.");
      }

      $("empVerify").disabled = true;
      $("empVerify").classList.add("opacity-60");

      try{
        const res = await apiPost("/api/verify-code", {
          phase: "finalise",
          purpose: "employee_signup",
          email: p.email,
          code,
          password: p.password,
          full_name: p.full_name,
          company_code: p.company_code
        });

        if(!res?.ok) throw new Error(res?.error || "Employee signup failed.");

        // optional auto-login
        const { error } = await sb.auth.signInWithPassword({ email: p.email, password: p.password });
        if(error) {
          showOk($("empVerifyMsg"), "Account created. You can now log in.");
        } else {
          showOk($("empVerifyMsg"), "Account created and logged in.");
        }

        // cleanup
        state.pendingEmployee = null;

        // close after a moment (nice UX)
        setTimeout(()=> closeModal($("empModalBackdrop")), 700);

      }catch(e){
        showErr($("empVerifyMsg"), String(e.message || e));
      }finally{
        $("empVerify").disabled = false;
        $("empVerify").classList.remove("opacity-60");
      }
    }

    /******************************************************************
      LOGIN (minimal)
    ******************************************************************/
    async function login(){
      clearErr($("liMsg"));

      const email = $("liEmail").value.trim().toLowerCase();
      const password = $("liPassword").value;

      if(!email) return showErr($("liMsg"), "Please enter your email.");
      if(!password) return showErr($("liMsg"), "Please enter your password.");

      $("liLogin").disabled = true;
      $("liLogin").classList.add("opacity-60");

      try{
        const { error } = await sb.auth.signInWithPassword({ email, password });
        if(error) throw new Error(error.message);

        showOk($("liMsg"), "Logged in. (Employee portal coming next.)");

      }catch(e){
        showErr($("liMsg"), String(e.message || "Login failed."));
      }finally{
        $("liLogin").disabled = false;
        $("liLogin").classList.remove("opacity-60");
      }
    }

    async function resetPassword(){
      clearErr($("liMsg"));
      const email = $("liEmail").value.trim().toLowerCase();
      if(!email) return showErr($("liMsg"), "Enter your email above, then click again.");
      try{
        const { error } = await sb.auth.resetPasswordForEmail(email, { redirectTo: window.location.origin + "/#reset" });
        if(error) throw new Error(error.message);
        showOk($("liMsg"), "Password reset email sent. Please check your inbox.");
      }catch(e){
        showErr($("liMsg"), String(e.message || "Failed to send reset email."));
      }
    }

    /******************************************************************
      WIRING
    ******************************************************************/
    function wire(){
      // hero
      $("heroBuild").onclick = ()=> $("packages").scrollIntoView({ behavior:"smooth", block:"start" });
      $("heroEmployee").onclick = ()=> openModal($("empModalBackdrop"));
      $("heroDown").onclick = ()=> $("packages").scrollIntoView({ behavior:"smooth", block:"start" });

      // nav
      $("navHome").onclick = ()=> window.scrollTo({ top:0, behavior:"smooth" });
      $("navEmployee").onclick = ()=> openModal($("empModalBackdrop"));
      $("navLogin").onclick = ()=> openModal($("loginModalBackdrop"));

      // company size
      document.querySelectorAll("[data-size]").forEach(btn=>{
        btn.addEventListener("click", ()=> setCompanySize(btn.dataset.size));
      });

      // plus inputs
      $("plusCount").addEventListener("input", ()=> hide($("plusWarn")));

      // checkout -> ALWAYS email now
      $("checkoutBtn").onclick = ()=>{
        const mailto = buildPlanEmail();
        if(!mailto) return;
        window.location.href = mailto;
      };

      // module modal
      $("mmClose").onclick = ()=> closeModal($("moduleModalBackdrop"));

      // employee modal
      $("empClose").onclick = ()=> closeModal($("empModalBackdrop"));
      $("empEye").onclick = ()=>{
        const p = $("empPassword");
        p.type = (p.type === "password") ? "text" : "password";
      };
      $("empSend").onclick = employeeSendCode;
      $("empResend").onclick = employeeResend;
      $("empVerify").onclick = employeeVerifyAndCreate;

      // login modal
      $("liClose").onclick = ()=> closeModal($("loginModalBackdrop"));
      $("liEye").onclick = ()=>{
        const p = $("liPassword");
        p.type = (p.type === "password") ? "text" : "password";
      };
      $("liLogin").onclick = login;
      $("liReset").onclick = resetPassword;

      // backdrop click closes
      [
        $("moduleModalBackdrop"),
        $("empModalBackdrop"),
        $("loginModalBackdrop")
      ].forEach(b=>{
        b.addEventListener("click", (e)=>{
          if(e.target === b) closeModal(b);
        });
      });

      // hero parallax
      window.addEventListener("mousemove", bubbleParallax, { passive:true });
      window.addEventListener("resize", buildBubbles, { passive:true });

      // custom module required fields: clear warn on input
      ["cWhat","cFor","cWho"].forEach(id=>{
        const el = $(id);
        if(el) el.addEventListener("input", ()=> clearErr($("customWarn")));
      });
    }

    /******************************************************************
      INIT
    ******************************************************************/
    async function init(){
      buildBubbles();
      initAnim();
      initNavHide();
      wire();

      renderModules();
      updateTotal();
    }

    init().catch(err=>{
      console.error(err);
      alert("Init error: " + (err.message || err));
    });
  </script>

</body>
</html>
