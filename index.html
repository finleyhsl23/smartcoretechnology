```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SmartCore Technology ‚Äî Practical Technology. Built to Last.</title>

  <!-- Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Tailwind CDN (OK for now/testing) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --bg0:#040814;
      --bg1:#060c1f;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.035);
      --stroke: rgba(255,255,255,.10);
      --stroke2: rgba(255,255,255,.08);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --muted2: rgba(255,255,255,.55);
      --accent: #5b86ff;          /* subtle blue */
      --accent2:#7aa2ff;
      --danger:#ff4d5f;
      --ok:#21c36a;
      --warn:#f5b84b;
      --r: 14px;
    }
    html,body{height:100%; background: radial-gradient(1200px 800px at 20% 0%, rgba(91,134,255,.15), transparent 60%),
                              radial-gradient(900px 600px at 85% 20%, rgba(122,162,255,.10), transparent 55%),
                              linear-gradient(180deg, var(--bg0), var(--bg1));
              color:var(--text); font-family:Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;}
    .glass{
      background: var(--panel);
      border: 1px solid var(--stroke);
      border-radius: var(--r);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .glass2{
      background: var(--panel2);
      border: 1px solid var(--stroke2);
      border-radius: var(--r);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    .btn{
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      transition: transform .15s ease, background .15s ease, border-color .15s ease, opacity .15s ease;
    }
    .btn:hover{background: rgba(255,255,255,.085); border-color: rgba(255,255,255,.18);}
    .btn:active{transform: translateY(1px);}
    .btn-primary{
      background: linear-gradient(180deg, rgba(91,134,255,.95), rgba(91,134,255,.78));
      border: 1px solid rgba(91,134,255,.65);
      color: #06112a;
      font-weight: 700;
    }
    .btn-primary:hover{filter: brightness(1.03);}
    .chip{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      border-radius: 999px;
    }
    .card{
      border-radius: var(--r);
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.045);
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
    }
    .card:hover{border-color: rgba(255,255,255,.16); background: rgba(255,255,255,.06);}
    .card.selected{
      border-color: rgba(91,134,255,.85);
      background: rgba(91,134,255,.10);
      outline: 2px solid rgba(91,134,255,.25);
    }
    .fade-in{
      opacity:0;
      transform: translateY(10px);
      animation: fadeIn .6s ease forwards;
    }
    @keyframes fadeIn{to{opacity:1; transform: translateY(0);}}
    .modal-overlay{
      position: fixed; inset: 0; z-index: 50;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
    }
    .modal-overlay.show{display:flex;}
    .modal{
      width: min(980px, 96vw);
      max-height: 88vh;
      overflow:auto;
    }
    /* stop iOS weirdness */
    .modal{-webkit-overflow-scrolling: touch;}
    /* hero icons */
    .hero-icon{
      position:absolute;
      width: 38px; height: 38px;
      opacity: .22;
      filter: saturate(.9);
      pointer-events:none;
      transition: transform .08s ease;
    }
    @media (min-width:768px){
      .hero-icon{width:42px;height:42px;opacity:.20;}
    }
    @media (min-width:1024px){
      .hero-icon{width:48px;height:48px;opacity:.18;}
    }
    /* hide scrollbar (optional) */
    .no-scrollbar::-webkit-scrollbar{width:0;height:0}
    .no-scrollbar{scrollbar-width:none}
  </style>

  <script>
    // >>> Put your Supabase values here (you already have them)
    // Make sure quotes are correct (you had a missing quote previously)
    window.__SUPABASE_URL  = "https://hjdpcfhozhoyeqevnupm.supabase.co";
    window.__SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhqZHBjZmhvemhveWVxZXZudXBtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5MTk3MzYsImV4cCI6MjA4MjQ5NTczNn0.BXosJO4NmEZOe73GXSGPa3z-i_4ZzF9zBAMBIf6Mkts";

    // Your API routes (Cloudflare Pages Functions)
    // Must exist in /functions/api/send-code.js and /functions/api/verify-code.js
    window.__API_BASE = ""; // same origin
  </script>
</head>

<body class="min-h-screen">

  <!-- NAV -->
  <header id="topNav" class="fixed top-0 left-0 right-0 z-40">
    <div class="mx-auto max-w-6xl px-4 py-3">
      <div class="glass flex items-center justify-between px-4 py-3">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl overflow-hidden border border-white/10 bg-white/5 flex items-center justify-center">
            <img src="SmartCore Official Logos/SC Icon - Black Background.png" alt="SmartCore" class="w-full h-full object-contain translate-y-[-2px]" />
          </div>
          <div class="leading-tight">
            <div class="text-sm font-semibold tracking-tight">SmartCore <span class="text-white/75">Technology</span></div>
            <div class="text-xs text-white/55">Practical Technology. Built to Last.</div>
          </div>
        </div>

        <div class="flex items-center gap-2">
          <button id="navLoginBtn" class="btn px-3 py-2 text-sm">Log In</button>
        </div>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main>

    <!-- HERO -->
    <section id="hero" class="relative pt-24">
      <div class="mx-auto max-w-6xl px-4">
        <div class="relative min-h-[calc(100vh-96px)] flex items-center">
          <!-- Scattered Icons -->
          <div id="heroIcons" class="absolute inset-0 overflow-hidden"></div>

          <div class="relative w-full">
            <div class="max-w-3xl">
              <div class="flex flex-wrap gap-2 mb-6">
                <span class="chip px-3 py-1 text-xs text-white/70">HR & Safety Systems</span>
                <span class="chip px-3 py-1 text-xs text-white/70">Modular SaaS</span>
                <span class="chip px-3 py-1 text-xs text-white/70">Built for UK businesses</span>
              </div>

              <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold tracking-tight leading-[1.05]">
                SmartCore <span class="text-white/75">Technology</span>
              </h1>
              <p class="mt-4 text-lg sm:text-xl text-white/70 max-w-2xl">
                Practical, reliable systems for presence, safety, and people operations ‚Äî designed to run quietly in the background and work when it matters.
              </p>

              <div class="mt-8 flex flex-wrap items-center gap-3">
                <button id="viewPackagesBtn" class="btn btn-primary px-5 py-3">
                  View Packages
                </button>
                <button id="scrollDownBtn" class="btn px-5 py-3">
                  Scroll Down
                </button>
              </div>

              <div class="mt-10 text-sm text-white/55">
                Calm, professional software ‚Äî no hype. Just tools built to last.
              </div>
            </div>

            <!-- Down Arrow -->
            <div class="mt-14">
              <button id="downArrowBtn" class="btn px-4 py-3 inline-flex items-center gap-2">
                <span class="text-white/70">Explore</span>
                <svg class="w-4 h-4 text-white/70" viewBox="0 0 24 24" fill="none">
                  <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>

          </div>
        </div>
      </div>
    </section>

    <!-- PACKAGES -->
    <section id="packages" class="py-16">
      <div class="mx-auto max-w-6xl px-4">
        <div class="mb-10">
          <h2 class="text-2xl sm:text-3xl font-bold tracking-tight">Build Your Plan</h2>
          <p class="mt-2 text-white/65 max-w-2xl">
            Choose your company size, then select the modules you want. Pricing updates live.
          </p>
        </div>

        <!-- Company Size -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
          <button class="card p-5 text-left" data-size-id="s25" data-size-label="Up to 25 people" data-size-price="39">
            <div class="text-sm text-white/65">Up to 25 people</div>
            <div class="mt-2 text-2xl font-bold">¬£39<span class="text-sm font-medium text-white/60">/month</span></div>
          </button>
          <button class="card p-5 text-left" data-size-id="s100" data-size-label="26‚Äì100 people" data-size-price="79">
            <div class="text-sm text-white/65">26‚Äì100 people</div>
            <div class="mt-2 text-2xl font-bold">¬£79<span class="text-sm font-medium text-white/60">/month</span></div>
          </button>
          <button class="card p-5 text-left" data-size-id="s250" data-size-label="101‚Äì250 people" data-size-price="149">
            <div class="text-sm text-white/65">101‚Äì250 people</div>
            <div class="mt-2 text-2xl font-bold">¬£149<span class="text-sm font-medium text-white/60">/month</span></div>
          </button>
          <button class="card p-5 text-left" data-size-id="s250p" data-size-label="250+ people" data-size-price="0">
            <div class="text-sm text-white/65">250+ people</div>
            <div class="mt-2 text-2xl font-bold">Contact<span class="text-sm font-medium text-white/60"> us</span></div>
          </button>
        </div>

        <!-- 250+ extra input -->
        <div id="bigCompanyBox" class="mt-6 hidden">
          <div class="glass p-5">
            <div class="flex flex-col lg:flex-row gap-4 lg:items-end">
              <div class="flex-1">
                <label class="text-sm text-white/70">Approximate company size</label>
                <input id="bigCompanySize" type="number" min="1" placeholder="e.g. 420" class="mt-2 w-full rounded-xl bg-white/5 border border-white/10 px-4 py-3 outline-none focus:border-white/20 text-white placeholder:text-white/35"/>
                <div id="bigCompanyWarn" class="mt-2 text-sm text-white/55"></div>
              </div>
              <div class="flex-1">
                <label class="text-sm text-white/70">Additional notes (optional)</label>
                <textarea id="bigCompanyNotes" rows="2" placeholder="Any requirements or context‚Ä¶" class="mt-2 w-full rounded-xl bg-white/5 border border-white/10 px-4 py-3 outline-none focus:border-white/20 text-white placeholder:text-white/35"></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- Modules -->
        <div id="modulesWrap" class="mt-10 hidden">
          <div class="flex items-end justify-between gap-4 flex-wrap">
            <div>
              <h3 class="text-xl font-semibold">Modules</h3>
              <p class="text-white/60 text-sm mt-1">Select only what you need. Add or remove later.</p>
            </div>
          </div>

          <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4" id="modulesGrid">
            <!-- JS renders -->
          </div>
        </div>

        <!-- Sticky Summary -->
        <div id="summaryBar" class="fixed bottom-0 left-0 right-0 z-30 hidden">
          <div class="mx-auto max-w-6xl px-4 pb-4">
            <div class="glass flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 px-4 py-4">
              <div>
                <div class="text-sm text-white/60">Monthly Total</div>
                <div class="text-2xl font-bold" id="totalText">¬£0 / month</div>
                <div class="text-xs text-white/45 mt-1" id="summaryHint"></div>
              </div>

              <div class="flex items-center gap-2">
                <button id="checkoutBtn" class="btn btn-primary px-5 py-3">
                  Continue
                </button>
              </div>
            </div>
          </div>
        </div>

      </div>
    </section>

    <!-- ABOUT -->
    <section id="about" class="py-16">
      <div class="mx-auto max-w-6xl px-4">
        <div class="glass p-7">
          <h2 class="text-2xl font-bold">About SmartCore Technology</h2>
          <div class="mt-3 text-white/70 leading-relaxed space-y-4">
            <p>
              SmartCore Technology was built by Finley Hassall, a young founder with a long-standing passion for technology and a strong business mindset. Interested in IT from the age of six, Finley always knew he wanted to build a career creating systems that solve real-world problems.
            </p>
            <p>
              Rather than focusing on trends or hype, SmartCore Technology was created with a clear goal: to build practical, reliable systems that businesses can depend on every day.
            </p>
            <p>
              The company was developed with guidance and support from Finley‚Äôs mother, a business owner herself, but every system within SmartCore has been hand-crafted from the ground up by Finley. Each feature, workflow, and decision has been designed with real workplaces in mind ‚Äî prioritising clarity, usability, and long-term reliability over unnecessary complexity.
            </p>
            <p>
              SmartCore Technology is not about flashy software. It‚Äôs about building tools that work properly, scale sensibly, and quietly do their job in the background.
            </p>
            <h3 class="text-xl font-semibold pt-2">The SmartCore Technology Approach</h3>
            <p>SmartCore Technology is built on a simple philosophy: technology should make work easier, not more complicated.</p>
            <ul class="list-disc pl-6 space-y-1">
              <li>solve a specific, real business problem</li>
              <li>be easy to understand and use</li>
              <li>create clear, auditable records</li>
              <li>scale as organisations grow</li>
              <li>remain reliable over time</li>
            </ul>
            <p>
              Instead of offering one large, bloated platform, SmartCore provides modular systems that companies can choose and combine based on their actual needs. This keeps costs fair, reduces complexity, and allows businesses to stay in control of how they operate.
            </p>
            <p>
              SmartCore Technology focuses on the areas that matter most ‚Äî people, safety, and operational clarity ‚Äî delivering tools that support organisations without getting in the way.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- FOOTER -->
    <footer class="py-10">
      <div class="mx-auto max-w-6xl px-4">
        <div class="glass2 px-5 py-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
          <div class="text-sm text-white/70">¬© <span id="year"></span> SmartCore Technology</div>
          <a class="text-sm text-white/70 hover:text-white" href="mailto:support@smartcoretechnology.co.uk">support@smartcoretechnology.co.uk</a>
        </div>
      </div>
    </footer>

  </main>

  <!-- MODULE LEARN MORE MODAL -->
  <div id="moduleModal" class="modal-overlay" aria-hidden="true">
    <div class="modal glass p-6">
      <div class="flex items-start justify-between gap-4">
        <div>
          <div class="text-xs text-white/55" id="mmPrice">¬£0 / month</div>
          <h3 class="text-2xl font-bold mt-1" id="mmTitle">Module</h3>
          <p class="mt-2 text-white/70" id="mmSummary"></p>
        </div>
        <button id="mmClose" class="btn px-3 py-2 text-sm">Close</button>
      </div>

      <div class="mt-5 grid grid-cols-1 lg:grid-cols-2 gap-5">
        <div class="glass2 p-4">
          <div class="text-sm text-white/70 mb-2">Preview</div>
          <div class="rounded-xl overflow-hidden border border-white/10">
            <iframe id="mmVideo" class="w-full aspect-video" src="https://www.youtube-nocookie.com/embed/S2kymv60ndQ" title="Preview" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen" allowfullscreen></iframe>
          </div>
          <div class="mt-3 text-xs text-white/55">Open fullscreen from the player controls.</div>
        </div>
        <div class="glass2 p-4">
          <div class="text-sm text-white/70 mb-2">Features</div>
          <ul class="space-y-2 text-white/70 text-sm" id="mmFeatures"></ul>
        </div>
      </div>
    </div>
  </div>

  <!-- LOGIN MODAL -->
  <div id="loginModal" class="modal-overlay" aria-hidden="true">
    <div class="modal glass p-6" style="width:min(560px, 96vw)">
      <div class="flex items-start justify-between gap-4">
        <div>
          <h3 class="text-2xl font-bold">Log In</h3>
          <p class="mt-2 text-white/70 text-sm">Access your dashboard and systems.</p>
        </div>
        <button id="loginClose" class="btn px-3 py-2 text-sm">Close</button>
      </div>

      <div class="mt-5 space-y-3">
        <div>
          <label class="text-sm text-white/70">Email</label>
          <input id="liEmail" type="email" class="mt-2 w-full rounded-xl bg-white/5 border border-white/10 px-4 py-3 outline-none focus:border-white/20 text-white placeholder:text-white/35" placeholder="name@company.co.uk">
        </div>
        <div>
          <label class="text-sm text-white/70">Password</label>
          <div class="mt-2 relative">
            <input id="liPass" type="password" class="w-full rounded-xl bg-white/5 border border-white/10 px-4 py-3 pr-12 outline-none focus:border-white/20 text-white placeholder:text-white/35" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            <button id="liEye" type="button" class="absolute right-2 top-1/2 -translate-y-1/2 btn px-3 py-2 text-xs" title="Show/Hide">
              üëÅ
            </button>
          </div>
          <button id="liBad" class="mt-2 text-sm text-white/55 hover:text-white hidden text-left">Incorrect credentials ‚Äî forgot your password?</button>
        </div>

        <div class="flex items-center gap-2 pt-2">
          <button id="loginBtn" class="btn btn-primary px-5 py-3 w-full">Continue</button>
        </div>

        <div class="pt-2 text-sm text-white/60">
          <div class="mt-2">
            <button id="noAccountBtn" class="text-white/70 hover:text-white underline underline-offset-4">Don‚Äôt have an account?</button>
          </div>
        </div>

        <div id="liMsg" class="text-sm text-white/70"></div>
      </div>
    </div>
  </div>

  <!-- SIGNUP MODAL -->
  <div id="signupModal" class="modal-overlay" aria-hidden="true">
    <div class="modal glass p-6" style="width:min(620px, 96vw)">
      <div class="flex items-start justify-between gap-4">
        <div>
          <h3 class="text-2xl font-bold">Create Company Account</h3>
          <p class="mt-2 text-white/70 text-sm">Create your company admin account. A 6-digit code will be emailed to confirm ownership.</p>
        </div>
        <button id="suClose" class="btn px-3 py-2 text-sm">Close</button>
      </div>

      <div class="mt-5 space-y-3">
        <div>
          <label class="text-sm text-white/70">Company name</label>
          <input id="suCompany" class="mt-2 w-full rounded-xl bg-white/5 border border-white/10 px-4 py-3 outline-none focus:border-white/20 text-white placeholder:text-white/35" placeholder="Your company name">
        </div>
        <div>
          <label class="text-sm text-white/70">Email</label>
          <input id="suEmail" type="email" class="mt-2 w-full rounded-xl bg-white/5 border border-white/10 px-4 py-3 outline-none focus:border-white/20 text-white placeholder:text-white/35" placeholder="name@company.co.uk">
        </div>
        <div>
          <label class="text-sm text-white/70">Password</label>
          <div class="mt-2 relative">
            <input id="suPass" type="password" class="w-full rounded-xl bg-white/5 border border-white/10 px-4 py-3 pr-12 outline-none focus:border-white/20 text-white placeholder:text-white/35" placeholder="Minimum 8 characters">
            <button id="suEye" type="button" class="absolute right-2 top-1/2 -translate-y-1/2 btn px-3 py-2 text-xs" title="Show/Hide">üëÅ</button>
          </div>
        </div>

        <div class="pt-2">
          <button id="sendCodeBtn" class="btn btn-primary px-5 py-3 w-full">Continue</button>
        </div>

        <div id="codeBox" class="hidden pt-2">
          <div class="glass2 p-4">
            <div class="text-sm text-white/70">Enter verification code</div>
            <input id="suCode" maxlength="6" class="mt-2 w-full rounded-xl bg-white/5 border border-white/10 px-4 py-3 outline-none focus:border-white/20 text-white placeholder:text-white/35" placeholder="6-digit code">
            <button id="verifyCreateBtn" class="mt-3 btn btn-primary px-5 py-3 w-full">Continue</button>
            <div class="mt-2 text-xs text-white/55">Codes expire after 10 minutes.</div>
          </div>
        </div>

        <div id="suMsg" class="text-sm text-white/70"></div>
      </div>
    </div>
  </div>

  <!-- PAYMENT MODAL (TEST) -->
  <div id="payModal" class="modal-overlay" aria-hidden="true">
    <div class="modal glass p-6" style="width:min(620px, 96vw)">
      <div class="flex items-start justify-between gap-4">
        <div>
          <h3 class="text-2xl font-bold">Payment</h3>
          <p class="mt-2 text-white/70 text-sm">Testing mode ‚Äî choose Accept or Decline. (Stripe will be added later.)</p>
        </div>
        <button id="payClose" class="btn px-3 py-2 text-sm">Close</button>
      </div>

      <div class="mt-6 glass2 p-5">
        <div class="text-sm text-white/60">Total</div>
        <div class="text-2xl font-bold mt-1" id="payTotal">¬£0 / month</div>
        <div class="text-sm text-white/55 mt-2" id="paySummary"></div>
      </div>

      <div class="mt-5 grid grid-cols-1 sm:grid-cols-2 gap-3">
        <button id="payAccept" class="btn btn-primary px-5 py-3">Accept</button>
        <button id="payDecline" class="btn px-5 py-3">Decline</button>
      </div>

      <div id="payMsg" class="mt-3 text-sm text-white/70"></div>
    </div>
  </div>

  <!-- DASHBOARD -->
  <section id="dashboard" class="hidden pt-24 pb-16">
    <div class="mx-auto max-w-6xl px-4">
      <div class="glass p-6">
        <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4">
          <div>
            <div class="text-xs text-white/55">Dashboard</div>
            <h2 class="text-2xl font-bold mt-1" id="dashCompany">Your Company</h2>
            <div class="mt-2 text-sm text-white/65" id="dashMeta"></div>
          </div>
          <div class="flex items-center gap-2">
            <button id="dashSignOut" class="btn px-4 py-3">Sign Out</button>
            <button id="dashBackHome" class="btn px-4 py-3">Back to site</button>
          </div>
        </div>

        <div class="mt-6 grid grid-cols-1 lg:grid-cols-3 gap-4">
          <div class="glass2 p-5 lg:col-span-2">
            <div class="flex items-center justify-between">
              <h3 class="font-semibold">Your Systems</h3>
              <button id="dashBuyMore" class="btn px-3 py-2 text-sm">Buy More</button>
            </div>
            <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3" id="dashSystems">
              <!-- JS renders -->
            </div>
          </div>

          <div class="glass2 p-5">
            <h3 class="font-semibold">Company Details</h3>
            <div class="mt-3 space-y-2 text-sm text-white/70">
              <div><span class="text-white/55">Company ID:</span> <span id="dashCompanyCode" class="font-semibold"></span></div>
              <div><span class="text-white/55">Team size:</span> <span id="dashSize"></span></div>
              <div><span class="text-white/55">Plan total:</span> <span id="dashTotal"></span></div>
            </div>
          </div>
        </div>

        <div id="dashMsg" class="mt-4 text-sm text-white/70"></div>
      </div>
    </div>
  </section>

  <script>
    // ---------- Utilities ----------
    const $ = (id)=>document.getElementById(id);

    function money(n){ return `¬£${Number(n||0).toFixed(0)}`; }

    function scrollToEl(el){
      el.scrollIntoView({ behavior:"smooth", block:"start" });
    }

    function showModal(el){
      el.classList.add("show");
      el.setAttribute("aria-hidden","false");
      document.body.style.overflow = "hidden";
    }
    function hideModal(el){
      el.classList.remove("show");
      el.setAttribute("aria-hidden","true");
      document.body.style.overflow = "";
    }

    async function apiPost(path, body){
      const res = await fetch((window.__API_BASE||"") + path, {
        method:"POST",
        headers:{ "content-type":"application/json" },
        body: JSON.stringify(body||{})
      });
      const txt = await res.text();
      let data = null;
      try{ data = JSON.parse(txt); }catch(e){ /* ignore */ }
      if(!res.ok){
        const msg = data?.error || txt || `Request failed (${res.status})`;
        throw new Error(msg);
      }
      return data ?? {};
    }

    // ---------- Data ----------
    const COMPANY_SIZES = [
      { id:"s25", label:"Up to 25 people", price:39, max:25 },
      { id:"s100", label:"26‚Äì100 people", price:79, max:100 },
      { id:"s250", label:"101‚Äì250 people", price:149, max:250 },
      { id:"s250p", label:"250+ people", price:0, max:999999 }
    ];

    const MODULES = [
      {
        id:"presence_fire",
        name:"Presence & Fire Safety",
        price:10,
        summary:"Real-time presence with a live evacuation list for drills and emergencies.",
        features:[
          "Live on-site list for staff and visitors",
          "Instant evacuation roll call",
          "Digital sign-in / sign-out",
          "Audit-ready logs for reviews",
          "Designed for speed and reliability"
        ]
      },
      {
        id:"policies_handbook",
        name:"Policies & Staff Handbook",
        price:7,
        summary:"Central policies with acknowledgement tracking and clear records.",
        features:[
          "Upload and organise policies",
          "Read & acknowledge tracking",
          "Re-acknowledgement on updates",
          "Manager visibility and reporting",
          "Clean recordkeeping without paper"
        ]
      },
      {
        id:"holiday_booking",
        name:"Holiday Booking",
        price:8,
        summary:"Simple requests and approvals, with team visibility of absences.",
        features:[
          "Quick holiday requests",
          "Approve / decline workflows",
          "Team calendar visibility",
          "No payroll complexity",
          "Clear audit trail"
        ]
      },
      {
        id:"accident_injury",
        name:"Accident & Injury Book",
        price:3,
        summary:"Digital incident reporting with exports and secure records.",
        features:[
          "Fast incident logging",
          "Attach photos and notes",
          "Witness details where needed",
          "Export records for compliance",
          "Secure, organised storage"
        ]
      },
      {
        id:"training_compliance",
        name:"Training & Compliance",
        price:9,
        summary:"Track expiry dates and reminders for training and compliance tasks.",
        features:[
          "Expiry tracking",
          "Automated reminders",
          "Compliance schedules",
          "Inspection/task oversight",
          "Consistent organisational view"
        ]
      },
      {
        id:"on_offboarding",
        name:"Onboarding & Offboarding",
        price:8,
        summary:"Structured checklists to ensure consistent joins and leavers.",
        features:[
          "New starter checklists",
          "Leaver checklists",
          "Department task coverage",
          "Completion records",
          "Smoother transitions"
        ]
      },
      {
        id:"expenses_upload",
        name:"Expenses Upload",
        price:6,
        summary:"Digital receipt uploads with categories and export options.",
        features:[
          "Receipt uploads",
          "Notes and categories",
          "Review pipeline",
          "Export for accounts/payroll",
          "Traceable, organised flow"
        ]
      },
      {
        id:"wellbeing_check",
        name:"Wellbeing Check",
        price:4,
        summary:"A lightweight visual pulse check using three simple options.",
        features:[
          "üôÇ Positive (green)",
          "üòê Neutral (amber)",
          "üôÅ Concerned (red)",
          "Trends over time",
          "No medical data; privacy-respecting"
        ]
      }
    ];

    // ---------- State ----------
    const sb = supabase.createClient(window.__SUPABASE_URL, window.__SUPABASE_ANON);
    const state = {
      size: null,              // chosen company size object
      modules: new Set(),      // selected module ids
      bigCompanyCount: null,
      pendingSignup: null,
      session: null,
      profile: null,
      company: null,
      subscription: null,
      employees: [],
      __profilesKey: "user_id" // detected
    };

    // ---------- Render modules ----------
    function renderModules(){
      const grid = $("modulesGrid");
      grid.innerHTML = "";

      for(const m of MODULES){
        const el = document.createElement("div");
        el.className = "card p-5 relative";
        el.dataset.mid = m.id;

        el.innerHTML = `
          <div class="flex items-start justify-between gap-3">
            <div>
              <div class="text-sm text-white/80 font-semibold">${m.name}</div>
              <div class="mt-1 text-xs text-white/55">${money(m.price)} / month</div>
            </div>
            <div class="w-8 h-8 rounded-xl border border-white/10 bg-white/5 flex items-center justify-center text-white/70" title="Selectable">
              ‚úì
            </div>
          </div>
          <div class="mt-4 flex items-center justify-between gap-2">
            <button class="btn px-3 py-2 text-sm learnMore">Learn more</button>
            <button class="btn px-3 py-2 text-sm toggleSelect">Select</button>
          </div>
        `;

        // clicking card toggles selection
        el.addEventListener("click", (e)=>{
          const isButton = e.target.closest("button");
          if(isButton) return; // handled below
          toggleModule(m.id);
        });

        el.querySelector(".toggleSelect").addEventListener("click", ()=> toggleModule(m.id));
        el.querySelector(".learnMore").addEventListener("click", ()=> openModuleModal(m.id));

        grid.appendChild(el);
      }

      syncSelectedUI();
    }

    function toggleModule(id){
      if(state.modules.has(id)) state.modules.delete(id);
      else state.modules.add(id);
      syncSelectedUI();
      updateTotal();
    }

    function syncSelectedUI(){
      document.querySelectorAll("[data-mid]").forEach(card=>{
        const id = card.dataset.mid;
        const selected = state.modules.has(id);
        card.classList.toggle("selected", selected);
        const btn = card.querySelector(".toggleSelect");
        btn.textContent = selected ? "Selected" : "Select";
        btn.classList.toggle("btn-primary", selected);
        btn.classList.toggle("btn", true);
      });
    }

    // ---------- Module modal ----------
    function openModuleModal(mid){
      const m = MODULES.find(x=>x.id===mid);
      if(!m) return;

      $("mmTitle").textContent = m.name;
      $("mmSummary").textContent = m.summary;
      $("mmPrice").textContent = `${money(m.price)} / month`;

      const ul = $("mmFeatures");
      ul.innerHTML = "";
      for(const f of m.features){
        const li = document.createElement("li");
        li.className = "flex gap-2";
        li.innerHTML = `<span class="text-white/60">‚Ä¢</span><span>${f}</span>`;
        ul.appendChild(li);
      }

      // fixed embed
      $("mmVideo").src = "https://www.youtube-nocookie.com/embed/S2kymv60ndQ";
      showModal($("moduleModal"));
    }

    // ---------- Company size selection ----------
    function selectCompanySize(sizeId){
      state.size = COMPANY_SIZES.find(s=>s.id===sizeId) || null;

      document.querySelectorAll("[data-size-id]").forEach(btn=>{
        btn.classList.toggle("selected", btn.dataset.sizeId===sizeId);
      });

      // reveal modules + summary once size selected
      $("modulesWrap").classList.toggle("hidden", !state.size);
      $("summaryBar").classList.toggle("hidden", !state.size);
      $("bigCompanyBox").classList.toggle("hidden", !(state.size && state.size.id==="s250p"));

      // reset big company input
      if(!(state.size && state.size.id==="s250p")){
        $("bigCompanySize").value = "";
        $("bigCompanyNotes").value = "";
        $("bigCompanyWarn").textContent = "";
        state.bigCompanyCount = null;
      }

      // ensure modules rendered
      renderModules();
      updateTotal();
      updateCheckoutButton();
    }

    function updateCheckoutButton(){
      const isBig = state.size?.id==="s250p";
      const btn = $("checkoutBtn");
      if(isBig){
        btn.textContent = "Contact Us";
        btn.classList.remove("btn-primary");
        btn.classList.add("btn-primary"); // keep primary look
      } else {
        btn.textContent = "Continue";
        btn.classList.remove("btn-primary");
        btn.classList.add("btn-primary");
      }
    }

    // ---------- Totals ----------
    function calcTotal(){
      let base = state.size ? state.size.price : 0;
      let mods = 0;
      for(const id of state.modules){
        const m = MODULES.find(x=>x.id===id);
        if(m) mods += m.price;
      }
      return { base, mods, total: base + mods };
    }

    function updateTotal(){
      const t = calcTotal();
      $("totalText").textContent = `${money(t.total)} / month`;
      const modsCount = state.modules.size;
      const sizeLabel = state.size ? state.size.label : "‚Äî";
      $("summaryHint").textContent = `Package: ${sizeLabel} ‚Ä¢ Modules: ${modsCount}`;
      $("payTotal").textContent = `${money(t.total)} / month`;

      // Pay summary
      const modNames = [...state.modules].map(id=>MODULES.find(m=>m.id===id)?.name).filter(Boolean);
      $("paySummary").textContent = modNames.length ? `Includes: ${modNames.join(", ")}` : `No modules selected yet.`;

      updateCheckoutButton();
    }

    // ---------- Contact email for 250+ ----------
    function buildContactMailto(){
      const sizeNum = Number($("bigCompanySize").value || 0);
      const notes = $("bigCompanyNotes").value || "";
      const moduleNames = [...state.modules].map(id=>MODULES.find(m=>m.id===id)?.name).filter(Boolean);

      const subject = "250+ Person Company - Wanting to Sign Up";
      const bodyLines = [
        "Hello SmartCore Technology,",
        "",
        "We would like to enquire about onboarding a 250+ person organisation.",
        "",
        `Approximate company size: ${sizeNum || "Not provided"}`,
        "",
        "Requested modules:",
        moduleNames.length ? moduleNames.map(n=>`- ${n}`).join("\n") : "- (None selected yet)",
        "",
        notes ? "Additional notes:\n" + notes : "Additional notes: (none)",
        "",
        "Regards,",
        "(Your name)"
      ];

      const body = bodyLines.join("\n");
      return `mailto:support@smartcoretechnology.co.uk?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    }

    // ---------- Auth / Signup flow (email code first) ----------
    // Important: we do NOT create Supabase auth user until code is verified via /api/verify-code
    async function startOwnerSignup(){
      $("suMsg").textContent = "";

      if(!state.size){ $("suMsg").textContent = "Select a company size first."; return; }

      const company_name = $("suCompany").value.trim();
      const email = $("suEmail").value.trim().toLowerCase();
      const password = $("suPass").value;

      if(!company_name){ $("suMsg").textContent = "Enter your company name."; return; }
      if(!email){ $("suMsg").textContent = "Enter your email."; return; }
      if(!password || password.length < 8){ $("suMsg").textContent = "Password must be at least 8 characters."; return; }

      // store pending (used after verification)
      state.pendingSignup = {
        company_name,
        email,
        password,
        company_size_id: state.size.id,
        company_size_label: state.size.label,
        company_size_price: state.size.price,
        big_company_size: state.size.id==="s250p" ? Number($("bigCompanySize").value || 0) : null,
        module_ids: [...state.modules]
      };

      // For 250+, we don't signup here. We contact instead.
      if(state.size.id==="s250p"){
        const sizeNum = Number($("bigCompanySize").value || 0);
        if(!sizeNum){
          $("suMsg").textContent = "Please enter an approximate company size first.";
          return;
        }
        if(sizeNum < 250){
          $("suMsg").textContent = "That looks below 250. If you meant 250+, adjust the number or choose the 101‚Äì250 package.";
          return;
        }
      }

      // send code
      $("sendCodeBtn").disabled = true;
      $("sendCodeBtn").classList.add("opacity-50");

      try{
        await apiPost("/api/send-code", {
          email,
          purpose: "owner_signup"
        });

        $("codeBox").classList.remove("hidden");
        $("suMsg").textContent = "Code sent. Check your inbox (and junk).";
      }catch(e){
        $("suMsg").textContent = e.message || "Failed to send code.";
      }finally{
        $("sendCodeBtn").disabled = false;
        $("sendCodeBtn").classList.remove("opacity-50");
      }
    }

    async function verifyAndCreateOwner(){
      $("suMsg").textContent = "";
      if(!state.pendingSignup){ $("suMsg").textContent = "Press Continue first."; return; }

      const code = $("suCode").value.trim();
      if(!code || code.length !== 6){ $("suMsg").textContent = "Enter the 6-digit code."; return; }

      // Payment screen first (testing)
      hideModal($("signupModal"));
      openPaymentModal();
    }

    function openPaymentModal(){
      updateTotal();
      $("payMsg").textContent = "";
      showModal($("payModal"));
    }

    async function acceptPaymentAndFinalize(){
      $("payMsg").textContent = "";
      const p = state.pendingSignup;
      if(!p){ $("payMsg").textContent = "No pending signup found."; return; }

      const code = $("suCode").value.trim();
      if(!code || code.length !== 6){ $("payMsg").textContent = "Verification code missing."; return; }

      // create via backend verify-code (which should create auth user + company + subscription)
      $("payAccept").disabled = true;
      $("payAccept").classList.add("opacity-50");

      try{
        const res = await apiPost("/api/verify-code", {
          purpose: "owner_signup",
          email: p.email,
          code,
          password: p.password,
          company_name: p.company_name,
          company_size_id: p.company_size_id,
          company_size_label: p.company_size_label,
          company_size_price: p.company_size_price,
          module_ids: p.module_ids,
          big_company_size: p.big_company_size
        });

        // expect backend to create user + then sign them in (returns session?) OR we sign in here
        // We'll sign in here with email/password (safe for testing)
        const { data, error } = await sb.auth.signInWithPassword({ email: p.email, password: p.password });
        if(error) throw new Error("Account created but login failed: " + error.message);

        state.pendingSignup = null;
        hideModal($("payModal"));

        await loadAccount();
        showDashboard();
        location.hash = "#dashboard";

      }catch(e){
        $("payMsg").textContent = e.message || "Payment accept failed.";
      }finally{
        $("payAccept").disabled = false;
        $("payAccept").classList.remove("opacity-50");
      }
    }

    function declinePayment(){
      $("payMsg").textContent = "Payment declined (testing). Nothing has been created.";
      // keep them on the payment modal
    }

    // ---------- Login ----------
    async function login(){
      $("liMsg").textContent = "";
      $("liBad").classList.add("hidden");

      const email = $("liEmail").value.trim().toLowerCase();
      const password = $("liPass").value;

      if(!email || !password){
        $("liMsg").textContent = "Enter email and password.";
        return;
      }

      $("loginBtn").disabled = true;
      $("loginBtn").classList.add("opacity-50");

      try{
        const { data, error } = await sb.auth.signInWithPassword({ email, password });
        if(error) throw error;

        hideModal($("loginModal"));
        await loadAccount();
        showDashboard();
        location.hash = "#dashboard";
      }catch(e){
        $("liMsg").textContent = "";
        $("liBad").classList.remove("hidden");
      }finally{
        $("loginBtn").disabled = false;
        $("loginBtn").classList.remove("opacity-50");
      }
    }

    async function resetPassword(){
      const email = $("liEmail").value.trim().toLowerCase();
      if(!email){ $("liMsg").textContent = "Enter your email first."; return; }

      // redirect back to site hash
      const redirectTo = location.origin + "/#reset";
      const { error } = await sb.auth.resetPasswordForEmail(email, { redirectTo });
      if(error) $("liMsg").textContent = error.message;
      else $("liMsg").textContent = "Password reset email sent.";
    }

    // ---------- Dashboard / Data loading with schema auto-detect ----------
    async function getProfileByAuthUserId(uid){
      // Try profiles.user_id first (most common)
      {
        const { data, error } = await sb.from("profiles").select("*").eq("user_id", uid).maybeSingle();
        if(!error) return { profile: data || null, key: "user_id" };
        if(!String(error.message||"").toLowerCase().includes("column")) throw error;
      }
      // Try profiles.id second
      {
        const { data, error } = await sb.from("profiles").select("*").eq("id", uid).maybeSingle();
        if(!error) return { profile: data || null, key: "id" };
        throw error;
      }
    }

    async function loadAccount(){
      const { data: { session } } = await sb.auth.getSession();
      state.session = session || null;

      if(!state.session?.user){
        state.profile = null;
        state.company = null;
        state.subscription = null;
        state.employees = [];
        return;
      }

      const uid = state.session.user.id;

      // profile auto-detect (fix for "profiles.id does not exist")
      let profKey = "user_id";
      try{
        const r = await getProfileByAuthUserId(uid);
        state.profile = r.profile;
        profKey = r.key;
      }catch(e){
        throw new Error("Profile load failed: " + (e.message || e));
      }
      state.__profilesKey = profKey;

      // company
      let comp = null;
      if(state.profile?.company_id){
        const { data, error } = await sb.from("companies").select("*").eq("id", state.profile.company_id).maybeSingle();
        if(error) throw new Error("Company load failed: " + error.message);
        comp = data;
      } else {
        const { data, error } = await sb.from("companies").select("*").eq("owner_user_id", uid).maybeSingle();
        if(error) throw new Error("Company load failed: " + error.message);
        comp = data;
      }
      state.company = comp || null;

      // subscription latest
      if(state.company?.id){
        const { data: sub, error: sErr } = await sb
          .from("subscriptions")
          .select("*")
          .eq("company_id", state.company.id)
          .order("created_at", { ascending:false })
          .limit(1)
          .maybeSingle();

        state.subscription = sErr ? null : (sub || null);

        // employees
        const { data: emps, error: eErr } = await sb
          .from("employees")
          .select("*")
          .eq("company_id", state.company.id)
          .order("created_at", { ascending:true });

        state.employees = eErr ? [] : (emps || []);
      }else{
        state.subscription = null;
        state.employees = [];
      }
    }

    function showDashboard(){
      // hide homepage sections
      document.querySelector("main").classList.add("hidden");
      $("dashboard").classList.remove("hidden");

      // render
      const c = state.company;
      $("dashCompany").textContent = c?.company_name || "Your Company";
      $("dashCompanyCode").textContent = c?.company_code || "‚Äî";
      $("dashSize").textContent = c?.company_size_label || c?.company_size || "‚Äî";

      // totals from subscription if exists
      const total = (state.subscription?.monthly_total ?? null);
      $("dashTotal").textContent = total !== null ? `${money(total)} / month` : "‚Äî";

      const meta = [];
      if(state.session?.user?.email) meta.push(state.session.user.email);
      if(c?.company_address) meta.push(c.company_address);
      $("dashMeta").textContent = meta.join(" ‚Ä¢ ");

      // systems quick links based on subscription module_ids
      const owned = (state.subscription?.module_ids || state.subscription?.selected_modules || []);
      const ownedSet = new Set(Array.isArray(owned) ? owned : []);
      const wrap = $("dashSystems");
      wrap.innerHTML = "";

      const ownedModules = MODULES.filter(m=> ownedSet.has(m.id));
      if(!ownedModules.length){
        wrap.innerHTML = `<div class="text-sm text-white/60">No modules purchased yet.</div>`;
      }else{
        for(const m of ownedModules){
          const tile = document.createElement("a");
          tile.href = "https://smartcoretechnology.co.uk";
          tile.target = "_blank";
          tile.className = "card p-4 block";
          tile.innerHTML = `
            <div class="text-sm font-semibold">${m.name}</div>
            <div class="text-xs text-white/60 mt-1">Open system</div>
          `;
          wrap.appendChild(tile);
        }
      }
    }

    function showHomepage(){
      $("dashboard").classList.add("hidden");
      document.querySelector("main").classList.remove("hidden");
      location.hash = "#";
    }

    async function signOut(){
      await sb.auth.signOut();
      state.session = null;
      state.profile = null;
      state.company = null;
      state.subscription = null;
      state.employees = [];
      showHomepage();
      scrollToEl($("hero"));
    }

    // ---------- Checkout click ----------
    function onCheckout(){
      if(!state.size){
        scrollToEl($("packages"));
        return;
      }

      // 250+ -> contact email (require size)
      if(state.size.id==="s250p"){
        const sizeNum = Number($("bigCompanySize").value || 0);
        if(!sizeNum){
          alert("Please enter an approximate company size first.");
          return;
        }
        if(sizeNum < 250){
          const ok = confirm("That number looks below 250. Are you sure you want the 250+ package?");
          if(!ok) return;
        }
        const mailto = buildContactMailto();
        window.location.href = mailto;
        return;
      }

      // Normal signup
      $("codeBox").classList.add("hidden");
      $("suCode").value = "";
      $("suMsg").textContent = "";
      $("sendCodeBtn").disabled = false;
      $("sendCodeBtn").classList.remove("opacity-50");

      showModal($("signupModal"));
    }

    // ---------- Hero icon scatter + mouse push (desktop only) ----------
    const HERO_ICON_COUNT = 8;
    const ICON_SVGS = [
      // small inline svg icons
      `<svg viewBox="0 0 24 24" fill="none"><path d="M7 12h10M12 7v10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>`,
      `<svg viewBox="0 0 24 24" fill="none"><path d="M7 8h10M7 12h10M7 16h7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>`,
      `<svg viewBox="0 0 24 24" fill="none"><path d="M12 3l8 4v10l-8 4-8-4V7l8-4z" stroke="currentColor" stroke-width="2"/></svg>`,
      `<svg viewBox="0 0 24 24" fill="none"><path d="M4 12a8 8 0 0 1 16 0" stroke="currentColor" stroke-width="2"/><path d="M12 12l3-3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>`,
      `<svg viewBox="0 0 24 24" fill="none"><path d="M7 12l3 3 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`,
      `<svg viewBox="0 0 24 24" fill="none"><path d="M12 2v6m0 8v6M4 12h6m8 0h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>`,
      `<svg viewBox="0 0 24 24" fill="none"><path d="M4 7h16M4 12h16M4 17h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>`,
      `<svg viewBox="0 0 24 24" fill="none"><path d="M12 21s7-4.5 7-11a7 7 0 0 0-14 0c0 6.5 7 11 7 11z" stroke="currentColor" stroke-width="2"/></svg>`
    ];

    const heroIconObjs = [];

    function buildHeroIcons(){
      const host = $("heroIcons");
      host.innerHTML = "";
      heroIconObjs.length = 0;

      const isFinePointer = window.matchMedia("(pointer:fine)").matches;
      const isLarge = window.innerWidth >= 1024;

      if(!isFinePointer) return; // no icons on touch devices

      for(let i=0;i<HERO_ICON_COUNT;i++){
        const d = document.createElement("div");
        d.className = "hero-icon text-white";
        d.innerHTML = ICON_SVGS[i % ICON_SVGS.length];

        // scatter: random across whole hero, but keep center region clearer
        const x = Math.random();
        const y = Math.random();

        // avoid middle band where text sits
        const safe = (x>0.20 && x<0.75 && y>0.20 && y<0.70);
        const finalX = safe ? (x<0.5 ? x-0.22 : x+0.22) : x;
        const finalY = safe ? (y<0.5 ? y-0.20 : y+0.20) : y;

        d.style.left = `${finalX*100}%`;
        d.style.top  = `${finalY*100}%`;

        host.appendChild(d);

        heroIconObjs.push({
          el: d,
          baseX: finalX,
          baseY: finalY,
          vx: 0, vy: 0,
          tx: 0, ty: 0
        });
      }
    }

    function animateHeroIcons(){
      const isFinePointer = window.matchMedia("(pointer:fine)").matches;
      if(!isFinePointer) return;

      const maxPush = 18;
      for(const o of heroIconObjs){
        // ease toward target
        o.vx += (o.tx - o.vx) * 0.12;
        o.vy += (o.ty - o.vy) * 0.12;
        o.el.style.transform = `translate(${o.vx}px, ${o.vy}px)`;
      }
      requestAnimationFrame(animateHeroIcons);
    }

    function setupMousePush(){
      const isFinePointer = window.matchMedia("(pointer:fine)").matches;
      if(!isFinePointer) return;

      const hero = $("hero");
      hero.addEventListener("mousemove", (e)=>{
        const rect = hero.getBoundingClientRect();
        const mx = (e.clientX - rect.left) / rect.width;
        const my = (e.clientY - rect.top) / rect.height;

        for(const o of heroIconObjs){
          const dx = (o.baseX - mx);
          const dy = (o.baseY - my);
          const dist = Math.sqrt(dx*dx + dy*dy) || 0.001;
          const force = Math.max(0, 0.20 - dist) / 0.20; // 0..1 near cursor
          const push = 22 * force;

          o.tx = (dx/dist) * push;
          o.ty = (dy/dist) * push;
        }
      });

      hero.addEventListener("mouseleave", ()=>{
        for(const o of heroIconObjs){
          o.tx = 0; o.ty = 0;
        }
      });
    }

    // ---------- Nav hide on scroll down past hero ----------
    let lastY = 0;
    function navAutoHide(){
      const nav = $("topNav");
      const y = window.scrollY || 0;
      const heroH = $("hero").offsetHeight || 600;

      // only hide once user is past hero
      const pastHero = y > (heroH * 0.65);

      if(!pastHero){
        nav.style.transform = "translateY(0)";
        nav.style.transition = "transform .18s ease";
        lastY = y;
        return;
      }

      const goingDown = y > lastY + 6;
      const goingUp = y < lastY - 6;

      if(goingDown) nav.style.transform = "translateY(-110%)";
      if(goingUp) nav.style.transform = "translateY(0)";
      nav.style.transition = "transform .18s ease";
      lastY = y;
    }

    // ---------- Password eye (subtle hover) ----------
    function setupEye(btnId, inputId){
      const btn = $(btnId);
      const input = $(inputId);
      btn.addEventListener("click", ()=>{
        input.type = (input.type === "password") ? "text" : "password";
      });
      btn.addEventListener("mouseenter", ()=>{
        btn.style.transform = "scale(.97)";
      });
      btn.addEventListener("mouseleave", ()=>{
        btn.style.transform = "scale(1)";
      });
    }

    // ---------- Init / Events ----------
    document.addEventListener("DOMContentLoaded", async ()=>{
      $("year").textContent = new Date().getFullYear();

      // Hero icon setup
      buildHeroIcons();
      setupMousePush();
      requestAnimationFrame(animateHeroIcons);

      window.addEventListener("resize", ()=>{
        buildHeroIcons();
      });

      // Company size cards
      document.querySelectorAll("[data-size-id]").forEach(btn=>{
        btn.addEventListener("click", ()=> selectCompanySize(btn.dataset.sizeId));
      });

      // buttons
      $("viewPackagesBtn").addEventListener("click", ()=> scrollToEl($("packages")));
      $("scrollDownBtn").addEventListener("click", ()=> scrollToEl($("packages")));
      $("downArrowBtn").addEventListener("click", ()=> scrollToEl($("packages")));
      $("checkoutBtn").addEventListener("click", onCheckout);

      // big company size validation
      $("bigCompanySize").addEventListener("input", ()=>{
        const v = Number($("bigCompanySize").value || 0);
        state.bigCompanyCount = v || null;
        if(v && v < 250){
          $("bigCompanyWarn").textContent = "That number looks below 250. If you meant 250+, adjust it or choose the 101‚Äì250 package.";
        }else{
          $("bigCompanyWarn").textContent = "";
        }
      });

      // module modal close
      $("mmClose").addEventListener("click", ()=> hideModal($("moduleModal")));
      $("moduleModal").addEventListener("click", (e)=>{ if(e.target === $("moduleModal")) hideModal($("moduleModal")); });

      // login modal open/close
      $("navLoginBtn").addEventListener("click", ()=> showModal($("loginModal")));
      $("loginClose").addEventListener("click", ()=> hideModal($("loginModal")));
      $("loginModal").addEventListener("click", (e)=>{ if(e.target === $("loginModal")) hideModal($("loginModal")); });

      // signup modal close
      $("suClose").addEventListener("click", ()=> hideModal($("signupModal")));
      $("signupModal").addEventListener("click", (e)=>{ if(e.target === $("signupModal")) hideModal($("signupModal")); });

      // pay modal close
      $("payClose").addEventListener("click", ()=> hideModal($("payModal")));
      $("payModal").addEventListener("click", (e)=>{ if(e.target === $("payModal")) hideModal($("payModal")); });

      // signup flow
      $("sendCodeBtn").addEventListener("click", startOwnerSignup);
      $("verifyCreateBtn").addEventListener("click", verifyAndCreateOwner);

      // payment
      $("payAccept").addEventListener("click", acceptPaymentAndFinalize);
      $("payDecline").addEventListener("click", declinePayment);

      // login flow
      $("loginBtn").addEventListener("click", login);
      $("liBad").addEventListener("click", resetPassword);

      // no account info popup
      $("noAccountBtn").addEventListener("click", ()=>{
        alert("If your company is already set up on SmartCore, ask your admin for the company code and sign up as an employee.\n\nIf you're new, build your plan, select modules, and create a company account to get started.");
      });

      // eyes
      setupEye("liEye", "liPass");
      setupEye("suEye", "suPass");

      // dashboard buttons
      $("dashSignOut").addEventListener("click", signOut);
      $("dashBackHome").addEventListener("click", showHomepage);

      // render initial modules (hidden until size selected)
      renderModules();
      updateTotal();
      updateCheckoutButton();

      // nav hide on scroll
      window.addEventListener("scroll", navAutoHide, { passive:true });

      // if already logged in, go dashboard
      try{
        await loadAccount();
        if(state.session?.user){
          showDashboard();
          location.hash = "#dashboard";
        }
      }catch(e){
        // keep on homepage if fails
        console.warn(e);
      }
    });
  </script>

</body>
</html>
```
